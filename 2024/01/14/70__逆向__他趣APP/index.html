

<!DOCTYPE html>
<html lang="en" data-default-color-scheme=auto>



<head>
  <meta charset="UTF-8">
  <link rel="apple-touch-icon" sizes="76x76" href="/img/heard.png">
  <link rel="icon" href="/img/heard.png">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=5.0, shrink-to-fit=no">
  <meta http-equiv="x-ua-compatible" content="ie=edge">
  
  <meta name="theme-color" content="#2f4154">
  <meta name="author" content="Tig3rHu">
  <meta name="keywords" content="HigerHu,vulnerability,security,cyber">
  
    <meta name="description" content="ROOT检测“  当前APP运行环境存在风险 (Root设备)，请您及时知晓并注意信息安全! “  Hook 检测使用算法助手定位到root检测弹窗的一些常规设置，去除弹窗，或者其他的绕过。当使用算法助手hook app 的时候，app 会检测hook 的环境，从而闪退。 使用frida 脚本直接闪退   frida -U -p 32218 -l .\java_hook通杀.js 可以看到直接会闪">
<meta property="og:type" content="article">
<meta property="og:title" content="apk逆向__他趣APP脱壳&amp;运行环境检测分析">
<meta property="og:url" content="https://tig3rhu.github.io/2024/01/14/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP/index.html">
<meta property="og:site_name" content="Tig3rHu&#39;s Blog">
<meta property="og:description" content="ROOT检测“  当前APP运行环境存在风险 (Root设备)，请您及时知晓并注意信息安全! “  Hook 检测使用算法助手定位到root检测弹窗的一些常规设置，去除弹窗，或者其他的绕过。当使用算法助手hook app 的时候，app 会检测hook 的环境，从而闪退。 使用frida 脚本直接闪退   frida -U -p 32218 -l .\java_hook通杀.js 可以看到直接会闪">
<meta property="og:locale" content="en_US">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240109221636023.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240110215010880.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240110215626753.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111100934608.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111101359601.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111223623332.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240109222700682.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111223826464.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111224602621.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145319294.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240114160423598.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145342031.png">
<meta property="og:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145108350.png">
<meta property="article:published_time" content="2024-01-14T14:15:58.761Z">
<meta property="article:modified_time" content="2024-01-14T14:18:11.849Z">
<meta property="article:author" content="Tig3rHu">
<meta property="article:tag" content="HigerHu,vulnerability,security,cyber">
<meta name="twitter:card" content="summary_large_image">
<meta name="twitter:image" content="https://tig3rhu.github.io/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240109221636023.png">
  
  
  
  <title>apk逆向__他趣APP脱壳&amp;运行环境检测分析 - Tig3rHu&#39;s Blog</title>

  <link  rel="stylesheet" href="https://lib.baomitu.com/twitter-bootstrap/4.6.1/css/bootstrap.min.css" />



  <link  rel="stylesheet" href="https://lib.baomitu.com/github-markdown-css/4.0.0/github-markdown.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/hint.css/2.7.0/hint.min.css" />

  <link  rel="stylesheet" href="https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.css" />



<!-- 主题依赖的图标库，不要自行修改 -->
<!-- Do not modify the link that theme dependent icons -->

<link rel="stylesheet" href="//at.alicdn.com/t/font_1749284_hj8rtnfg7um.css">



<link rel="stylesheet" href="//at.alicdn.com/t/font_1736178_lbnruvf0jn.css">


<link  rel="stylesheet" href="/css/main.css" />


  <link id="highlight-css" rel="stylesheet" href="/css/highlight.css" />
  
    <link id="highlight-css-dark" rel="stylesheet" href="/css/highlight-dark.css" />
  




  <script id="fluid-configs">
    var Fluid = window.Fluid || {};
    Fluid.ctx = Object.assign({}, Fluid.ctx)
    var CONFIG = {"hostname":"tig3rhu.github.io","root":"/","version":"1.9.7","typing":{"enable":true,"typeSpeed":70,"cursorChar":"_","loop":false,"scope":[]},"anchorjs":{"enable":true,"element":"h1,h2,h3,h4,h5,h6","placement":"left","visible":"hover","icon":""},"progressbar":{"enable":true,"height_px":3,"color":"#29d","options":{"showSpinner":false,"trickleSpeed":100}},"code_language":{"enable":true,"default":"TEXT"},"copy_btn":true,"image_caption":{"enable":true},"image_zoom":{"enable":true,"img_url_replace":["",""]},"toc":{"enable":true,"placement":"right","headingSelector":"h1,h2,h3,h4,h5,h6","collapseDepth":0},"lazyload":{"enable":true,"loading_img":"/img/loading.gif","onlypost":false,"offset_factor":2},"web_analytics":{"enable":false,"follow_dnt":true,"baidu":null,"google":{"measurement_id":null},"tencent":{"sid":null,"cid":null},"woyaola":null,"cnzz":null,"leancloud":{"app_id":null,"app_key":null,"server_url":null,"path":"window.location.pathname","ignore_local":false}},"search_path":"/local-search.xml","include_content_in_search":true};

    if (CONFIG.web_analytics.follow_dnt) {
      var dntVal = navigator.doNotTrack || window.doNotTrack || navigator.msDoNotTrack;
      Fluid.ctx.dnt = dntVal && (dntVal.startsWith('1') || dntVal.startsWith('yes') || dntVal.startsWith('on'));
    }
  </script>
  <script  src="/js/utils.js" ></script>
  <script  src="/js/color-schema.js" ></script>
  


  
<meta name="generator" content="Hexo 7.0.0"></head>


<body>
  

  <header>
    

<div class="header-inner" style="height: 70vh;">
  <nav id="navbar" class="navbar fixed-top  navbar-expand-lg navbar-dark scrolling-navbar">
  <div class="container">
    <a class="navbar-brand" href="/">
      <strong>Tiger</strong>
    </a>

    <button id="navbar-toggler-btn" class="navbar-toggler" type="button" data-toggle="collapse"
            data-target="#navbarSupportedContent"
            aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
      <div class="animated-icon"><span></span><span></span><span></span></div>
    </button>

    <!-- Collapsible content -->
    <div class="collapse navbar-collapse" id="navbarSupportedContent">
      <ul class="navbar-nav ml-auto text-center">
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/" target="_self">
                <i class="iconfont icon-home-fill"></i>
                <span>Home</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/archives/" target="_self">
                <i class="iconfont icon-archive-fill"></i>
                <span>Archives</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/categories/" target="_self">
                <i class="iconfont icon-category-fill"></i>
                <span>Categories</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/tags/" target="_self">
                <i class="iconfont icon-tags-fill"></i>
                <span>Tags</span>
              </a>
            </li>
          
        
          
          
          
          
            <li class="nav-item">
              <a class="nav-link" href="/about/" target="_self">
                <i class="iconfont icon-user-fill"></i>
                <span>About</span>
              </a>
            </li>
          
        
        
          <li class="nav-item" id="search-btn">
            <a class="nav-link" target="_self" href="javascript:;" data-toggle="modal" data-target="#modalSearch" aria-label="Search">
              <i class="iconfont icon-search"></i>
            </a>
          </li>
          
        
        
          <li class="nav-item" id="color-toggle-btn">
            <a class="nav-link" target="_self" href="javascript:;" aria-label="Color Toggle">
              <i class="iconfont icon-dark" id="color-toggle-icon"></i>
            </a>
          </li>
        
      </ul>
    </div>
  </div>
</nav>

  

<div id="banner" class="banner" parallax=true
     style="background: url('/img/radio.png') no-repeat center center; background-size: cover;">
  <div class="full-bg-img">
    <div class="mask flex-center" style="background-color: rgba(0, 0, 0, 0.3)">
      <div class="banner-text text-center fade-in-up">
        <div class="h2">
          
            <span id="subtitle" data-typed-text="apk逆向__他趣APP脱壳&amp;运行环境检测分析"></span>
          
        </div>

        
          
  <div class="mt-3">
    
    
      <span class="post-meta">
        <i class="iconfont icon-date-fill" aria-hidden="true"></i>
        <time datetime="2024-01-14 22:15" pubdate>
          January 14, 2024 pm
        </time>
      </span>
    
  </div>

  <div class="mt-1">
    
      <span class="post-meta mr-2">
        <i class="iconfont icon-chart"></i>
        
          3.8k words
        
      </span>
    

    
      <span class="post-meta mr-2">
        <i class="iconfont icon-clock-fill"></i>
        
        
        
          32 mins
        
      </span>
    

    
    
  </div>


        
      </div>

      
    </div>
  </div>
</div>

</div>

  </header>

  <main>
    
      

<div class="container-fluid nopadding-x">
  <div class="row nomargin-x">
    <div class="side-col d-none d-lg-block col-lg-2">
      

    </div>

    <div class="col-lg-8 nopadding-x-md">
      <div class="container nopadding-x-md" id="board-ctn">
        <div id="board">
          <article class="post-content mx-auto">
            <h1 id="seo-header">apk逆向__他趣APP脱壳&amp;运行环境检测分析</h1>
            
            
              <div class="markdown-body">
                
                <h2 id="ROOT检测"><a href="#ROOT检测" class="headerlink" title="ROOT检测"></a>ROOT检测</h2><p>“  当前APP运行环境存在风险 (Root设备)，请您及时知晓并注意信息安全! “</p>
<p><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240109221636023.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="Hook-检测"><a href="#Hook-检测" class="headerlink" title="Hook 检测"></a>Hook 检测</h2><p>使用算法助手定位到root检测弹窗的一些常规设置，去除弹窗，或者其他的绕过。<br>当使用算法助手hook app 的时候，app 会检测hook 的环境，从而闪退。</p>
<p>使用frida 脚本直接闪退<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240110215010880.png" srcset="/img/loading.gif" lazyload></p>
<blockquote>
<p> frida -U -p 32218 -l .\java_hook通杀.js<br> 可以看到直接会闪退。<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240110215626753.png" srcset="/img/loading.gif" lazyload></p>
</blockquote>
<h3 id="load-so-js"><a href="#load-so-js" class="headerlink" title="load_so.js"></a>load_so.js</h3><p>这里可以判定apk 使用了一些方法来阻止frida 进行hook， 一般是在 so 文件内进行处理。所以这里我们直接可以找找app在运行的过程中，使用了那些so。最后调用的那个so 文件，就是检测hook环境的库文件。</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-comment">// load_so.js</span><br><span class="hljs-keyword">var</span> dlopen = Module.findExportByName(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;dlopen&quot;</span>);<br><span class="hljs-keyword">var</span> android_dlopen_ext = Module.findExportByName(<span class="hljs-literal">null</span>, <span class="hljs-string">&quot;android_dlopen_ext&quot;</span>);<br>Interceptor.attach(dlopen, &#123;<br>    <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>        <span class="hljs-keyword">var</span> path_ptr = args[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">var</span> path = ptr(path_ptr).readCString();<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;[dlopen:]&quot;</span>, path);<br>    &#125;,<br>    <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) &#123;&#125;<br>&#125;);<br>Interceptor.attach(android_dlopen_ext, &#123;<br>    <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>        <span class="hljs-keyword">var</span> path_ptr = args[<span class="hljs-number">0</span>];<br>        <span class="hljs-keyword">var</span> path = ptr(path_ptr).readCString();<br>        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&quot;[dlopen_ext:]&quot;</span>, path);<br>    &#125;,<br>    <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) &#123;&#125;<br>&#125;);<br></code></pre></td></tr></table></figure>


<p>使用脚本一直不行，因为用的一直是attach模式</p>
<figure class="highlight autohotkey"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><code class="hljs autohotkey">Frida中的`spawn`和`attach`是两种不同的操作模式，用于与目标进程进行交互。<br><br><span class="hljs-number">1</span>. `spawn`模式：在`spawn`模式下，Frida会启动一个新的目标进程，并且在该进程中加载指定的脚本。这意味着目标进程是由Frida直接创建的，并且可以在进程启动时就注入脚本。使用`spawn`模式可以在目标进程运行之前就对其进行动态修改、监控或调试。<br>    <br><span class="hljs-number">2</span>. `attach`模式：在`attach`模式下，Frida会连接到一个已经运行的目标进程，并且在该进程中加载指定的脚本。这意味着目标进程必须已经在运行中，而且Frida需要通过进程ID或进程名称将其连接起来。使用`attach`模式可以在目标进程运行时对其进行动态修改、监控或调试。<br>    <br><br>总结而言，`spawn`模式适用于在目标进程启动之前注入脚本，而`attach`模式适用于连接到已经运行的目标进程并注入脚本。选择使用哪种模式取决于您的具体需求和目标进程的状态。<br></code></pre></td></tr></table></figure>

<p>使用 spawn 模式，可以看到是 libnesec.so 文件，这是网易易盾的加壳so。</p>
<p>这是pixel 6Pro 手机hook ,可以看到。</p>
<p><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111100934608.png" srcset="/img/loading.gif" lazyload></p>
<p>但是换成moto 手机却不行，“ Failed to spawn: unexpectedly timed out while waiting for signal from process with PID 12337 ”，猜测这与手机系统有关。</p>
<p><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111101359601.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="hook-libnesc-so"><a href="#hook-libnesc-so" class="headerlink" title="hook libnesc.so"></a>hook libnesc.so</h3><p>前面我们知道 libnesec 会检测frida hook， 那么可以直接hook libnesec.so ，当调用libnesec 库的时候，让其返回空</p>
<figure class="highlight arcade"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><code class="hljs arcade"><span class="hljs-keyword">function</span> <span class="hljs-title function_">hook_pthread_create</span>(<span class="hljs-params"></span>) &#123;<br>    <span class="hljs-keyword">var</span> pt_create_func = Module.findExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&#x27;pthread_create&#x27;</span>);<br>    Interceptor.attach(pt_create_func, &#123;<br>        <span class="hljs-attr">onEnter</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">args</span>) &#123;<br>            <span class="hljs-comment">// 是那个so文件调用我，创建线程</span><br>            <span class="hljs-keyword">var</span> so_name = Process.findModuleByAddress(args[<span class="hljs-number">2</span>]).name;<br>            <span class="hljs-keyword">if</span> (so_name.<span class="hljs-built_in">indexOf</span>(<span class="hljs-string">&quot;libnesec&quot;</span>) != <span class="hljs-number">-1</span>) &#123;<br>                try &#123;<br>                    Interceptor.<span class="hljs-built_in">replace</span>(args[<span class="hljs-number">2</span>], <span class="hljs-keyword">new</span> NativeCallback(<span class="hljs-keyword">function</span>(<span class="hljs-params"></span>) &#123;<br>                        <span class="hljs-built_in">console</span>.<span class="hljs-built_in">log</span>(<span class="hljs-string">&#x27;replace success&#x27;</span>);<br>                        <span class="hljs-keyword">return</span> <span class="hljs-literal">null</span>;<br>                    &#125;, <span class="hljs-string">&#x27;void&#x27;</span>, [<span class="hljs-string">&quot;void&quot;</span>]));<br>                &#125; catch (e) &#123;&#125;<br>            &#125;<br>        &#125;,<br>        <span class="hljs-attr">onLeave</span>: <span class="hljs-keyword">function</span>(<span class="hljs-params">retval</span>) &#123;&#125;<br>    &#125;)<br>&#125;<br>hook_pthread_create();<br></code></pre></td></tr></table></figure>

<p>可以看到替换成功了。</p>
<p><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111223623332.png" srcset="/img/loading.gif" lazyload></p>
<h2 id="网易易盾脱壳"><a href="#网易易盾脱壳" class="headerlink" title="网易易盾脱壳"></a>网易易盾脱壳</h2><p>使用 jadx  打开 apk ，会发现存在 libnesec.so 文件，猜测加固了。因为反编译看不到要的伪java源码。因此需要去脱壳。</p>
<p><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240109222700682.png" srcset="/img/loading.gif" lazyload></p>
<h3 id="查壳"><a href="#查壳" class="headerlink" title="查壳"></a>查壳</h3><h4 id="MT-管理器"><a href="#MT-管理器" class="headerlink" title="MT 管理器"></a>MT 管理器</h4><p>可以查出来是网易易盾的加固</p>
<h4 id="PKID-查壳"><a href="#PKID-查壳" class="headerlink" title="PKID 查壳"></a>PKID 查壳</h4><p>查不出来，看过别人用pkid 可以查出来，可能版本不一样。</p>
<h3 id="dump-dex脱壳"><a href="#dump-dex脱壳" class="headerlink" title="dump_dex脱壳"></a>dump_dex脱壳</h3><p>脱壳前提： 要一直运行hook_libnesec.js 文件，保证frida 能够hook 而不被libnesec.so 检测到闪退，影响脱壳。<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111223826464.png" srcset="/img/loading.gif" lazyload></p>
<p>脱壳脚本</p>
<figure class="highlight scheme"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br><span class="line">66</span><br><span class="line">67</span><br><span class="line">68</span><br><span class="line">69</span><br><span class="line">70</span><br><span class="line">71</span><br><span class="line">72</span><br><span class="line">73</span><br><span class="line">74</span><br><span class="line">75</span><br><span class="line">76</span><br><span class="line">77</span><br><span class="line">78</span><br><span class="line">79</span><br><span class="line">80</span><br><span class="line">81</span><br><span class="line">82</span><br><span class="line">83</span><br><span class="line">84</span><br><span class="line">85</span><br><span class="line">86</span><br><span class="line">87</span><br><span class="line">88</span><br><span class="line">89</span><br><span class="line">90</span><br><span class="line">91</span><br><span class="line">92</span><br><span class="line">93</span><br><span class="line">94</span><br><span class="line">95</span><br><span class="line">96</span><br><span class="line">97</span><br><span class="line">98</span><br><span class="line">99</span><br><span class="line">100</span><br><span class="line">101</span><br><span class="line">102</span><br><span class="line">103</span><br><span class="line">104</span><br><span class="line">105</span><br><span class="line">106</span><br><span class="line">107</span><br><span class="line">108</span><br><span class="line">109</span><br><span class="line">110</span><br><span class="line">111</span><br><span class="line">112</span><br><span class="line">113</span><br><span class="line">114</span><br><span class="line">115</span><br><span class="line">116</span><br><span class="line">117</span><br><span class="line">118</span><br><span class="line">119</span><br><span class="line">120</span><br><span class="line">121</span><br><span class="line">122</span><br><span class="line">123</span><br><span class="line">124</span><br><span class="line">125</span><br><span class="line">126</span><br><span class="line">127</span><br><span class="line">128</span><br><span class="line">129</span><br><span class="line">130</span><br><span class="line">131</span><br><span class="line">132</span><br><span class="line">133</span><br><span class="line">134</span><br><span class="line">135</span><br><span class="line">136</span><br><span class="line">137</span><br></pre></td><td class="code"><pre><code class="hljs scheme">(<span class="hljs-name">function</span>() &#123;<br>    function klog(<span class="hljs-name">data</span>) &#123;<br>        var message = &#123;&#125;<span class="hljs-comment">;</span><br>        message[<span class="hljs-string">&quot;jsname&quot;</span>] = <span class="hljs-string">&quot;dump_dex&quot;</span><span class="hljs-comment">;</span><br>        message[<span class="hljs-string">&quot;data&quot;</span>] = data<span class="hljs-comment">;</span><br>        send(<span class="hljs-name">message</span>)<span class="hljs-comment">;</span><br>    &#125;<br><br>    function klogData(<span class="hljs-name">data</span>, key, value) &#123;<br>        var message = &#123;&#125;<span class="hljs-comment">;</span><br>        message[<span class="hljs-string">&quot;jsname&quot;</span>] = <span class="hljs-string">&quot;dump_dex&quot;</span><span class="hljs-comment">;</span><br>        message[<span class="hljs-string">&quot;data&quot;</span>] = data<span class="hljs-comment">;</span><br>        message[<span class="hljs-name">key</span>] = value<span class="hljs-comment">;</span><br>        send(<span class="hljs-name">message</span>)<span class="hljs-comment">;</span><br>    &#125;<br><br>    function get_self_process_name() &#123;<br>        var openPtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;open</span>&#x27;)<span class="hljs-comment">;</span><br>        var open = new NativeFunction(<span class="hljs-name">openPtr</span>, <span class="hljs-symbol">&#x27;int</span>&#x27;, [<span class="hljs-symbol">&#x27;pointer</span>&#x27;, <span class="hljs-symbol">&#x27;int</span>&#x27;])<span class="hljs-comment">;</span><br><br>        var readPtr = Module.getExportByName(<span class="hljs-string">&quot;libc.so&quot;</span>, <span class="hljs-string">&quot;read&quot;</span>)<span class="hljs-comment">;</span><br>        var read = new NativeFunction(<span class="hljs-name">readPtr</span>, <span class="hljs-string">&quot;int&quot;</span>, [<span class="hljs-string">&quot;int&quot;</span>, <span class="hljs-string">&quot;pointer&quot;</span>, <span class="hljs-string">&quot;int&quot;</span>])<span class="hljs-comment">;</span><br><br>        var closePtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;close</span>&#x27;)<span class="hljs-comment">;</span><br>        var close = new NativeFunction(<span class="hljs-name">closePtr</span>, <span class="hljs-symbol">&#x27;int</span>&#x27;, [<span class="hljs-symbol">&#x27;int</span>&#x27;])<span class="hljs-comment">;</span><br><br>        var path = Memory.allocUtf8String(<span class="hljs-string">&quot;/proc/self/cmdline&quot;</span>)<span class="hljs-comment">;</span><br>        var fd = open(<span class="hljs-name">path</span>, <span class="hljs-number">0</span>)<span class="hljs-comment">;</span><br>        if (<span class="hljs-name">fd</span> != <span class="hljs-number">-1</span>) &#123;<br>            var buffer = Memory.alloc(<span class="hljs-name">0x1000</span>)<span class="hljs-comment">;</span><br><br>            var result = read(<span class="hljs-name">fd</span>, buffer, <span class="hljs-number">0</span>x1000)<span class="hljs-comment">;</span><br>            close(<span class="hljs-name">fd</span>)<span class="hljs-comment">;</span><br>            result = ptr(<span class="hljs-name">buffer</span>).readCString()<span class="hljs-comment">;</span><br>            return result<span class="hljs-comment">;</span><br>        &#125;<br><br>        return <span class="hljs-string">&quot;-1&quot;</span><span class="hljs-comment">;</span><br>    &#125;<br><br><br>    function mkdir(<span class="hljs-name">path</span>) &#123;<br>        var mkdirPtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;mkdir</span>&#x27;)<span class="hljs-comment">;</span><br>        var mkdir = new NativeFunction(<span class="hljs-name">mkdirPtr</span>, <span class="hljs-symbol">&#x27;int</span>&#x27;, [<span class="hljs-symbol">&#x27;pointer</span>&#x27;, <span class="hljs-symbol">&#x27;int</span>&#x27;])<span class="hljs-comment">;</span><br><br><br><br>        var opendirPtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;opendir</span>&#x27;)<span class="hljs-comment">;</span><br>        var opendir = new NativeFunction(<span class="hljs-name">opendirPtr</span>, <span class="hljs-symbol">&#x27;pointer</span>&#x27;, [<span class="hljs-symbol">&#x27;pointer</span>&#x27;])<span class="hljs-comment">;</span><br><br>        var closedirPtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;closedir</span>&#x27;)<span class="hljs-comment">;</span><br>        var closedir = new NativeFunction(<span class="hljs-name">closedirPtr</span>, <span class="hljs-symbol">&#x27;int</span>&#x27;, [<span class="hljs-symbol">&#x27;pointer</span>&#x27;])<span class="hljs-comment">;</span><br><br>        var cPath = Memory.allocUtf8String(<span class="hljs-name">path</span>)<span class="hljs-comment">;</span><br>        var dir = opendir(<span class="hljs-name">cPath</span>)<span class="hljs-comment">;</span><br>        if (<span class="hljs-name">dir</span> != <span class="hljs-number">0</span>) &#123;<br>            closedir(<span class="hljs-name">dir</span>)<span class="hljs-comment">;</span><br>            return <span class="hljs-number">0</span><span class="hljs-comment">;</span><br>        &#125;<br>        mkdir(<span class="hljs-name">cPath</span>, <span class="hljs-number">755</span>)<span class="hljs-comment">;</span><br>        chmod(<span class="hljs-name">path</span>)<span class="hljs-comment">;</span><br>    &#125;<br><br>    function chmod(<span class="hljs-name">path</span>) &#123;<br>        var chmodPtr = Module.getExportByName(<span class="hljs-symbol">&#x27;libc.so</span>&#x27;, <span class="hljs-symbol">&#x27;chmod</span>&#x27;)<span class="hljs-comment">;</span><br>        var chmod = new NativeFunction(<span class="hljs-name">chmodPtr</span>, <span class="hljs-symbol">&#x27;int</span>&#x27;, [<span class="hljs-symbol">&#x27;pointer</span>&#x27;, <span class="hljs-symbol">&#x27;int</span>&#x27;])<span class="hljs-comment">;</span><br>        var cPath = Memory.allocUtf8String(<span class="hljs-name">path</span>)<span class="hljs-comment">;</span><br>        chmod(<span class="hljs-name">cPath</span>, <span class="hljs-number">755</span>)<span class="hljs-comment">;</span><br>    &#125;<br><br>    function dump_dex() &#123;<br>        var libart = Process.findModuleByName(<span class="hljs-string">&quot;libart.so&quot;</span>)<span class="hljs-comment">;</span><br>        var addr_DefineClass = null<span class="hljs-comment">;</span><br>        var symbols = libart.enumerateSymbols()<span class="hljs-comment">;</span><br>        for (<span class="hljs-name">var</span> index = <span class="hljs-number">0</span><span class="hljs-comment">; index &lt; symbols.length; index++) &#123;</span><br>            var symbol = symbols[<span class="hljs-name">index</span>]<span class="hljs-comment">;</span><br>            var symbol_name = symbol.name<span class="hljs-comment">;</span><br>            //这个DefineClass的函数签名是Android9的<br>            //_ZN3art11ClassLinker11DefineClassEPNS_6ThreadEPKcmNS_6HandleINS_6mirror11ClassLoaderEEERKNS_7DexFileERKNS9_8ClassDefE<br>            if (<span class="hljs-name">symbol_name.indexOf</span>(<span class="hljs-string">&quot;ClassLinker&quot;</span>) &gt;= <span class="hljs-number">0</span> &amp;&amp;<br>                symbol_name.indexOf(<span class="hljs-string">&quot;DefineClass&quot;</span>) &gt;= <span class="hljs-number">0</span> &amp;&amp;<br>                symbol_name.indexOf(<span class="hljs-string">&quot;Thread&quot;</span>) &gt;= <span class="hljs-number">0</span> &amp;&amp;<br>                symbol_name.indexOf(<span class="hljs-string">&quot;DexFile&quot;</span>) &gt;= <span class="hljs-number">0</span>) &#123;<br>                console.log(<span class="hljs-name">symbol_name</span>, symbol.address)<span class="hljs-comment">;</span><br>                addr_DefineClass = symbol.address<span class="hljs-comment">;</span><br>            &#125;<br>        &#125;<br>        var dex_maps = &#123;&#125;<span class="hljs-comment">;</span><br>        var dex_count = <span class="hljs-number">1</span><span class="hljs-comment">;</span><br><br>        console.log(<span class="hljs-string">&quot;[DefineClass:]&quot;</span>, addr_DefineClass)<span class="hljs-comment">;</span><br>        if (<span class="hljs-name">addr_DefineClass</span>) &#123;<br>            Interceptor.attach(<span class="hljs-name">addr_DefineClass</span>, &#123;<br>                onEnter: function(<span class="hljs-name">args</span>) &#123;<br>                    var dex_file = args[<span class="hljs-name">5</span>]<span class="hljs-comment">;</span><br>                    //ptr(<span class="hljs-name">dex_file</span>).add(<span class="hljs-name">Process.pointerSize</span>) is <span class="hljs-string">&quot;const uint8_t* const begin_;&quot;</span><br>                    //ptr(<span class="hljs-name">dex_file</span>).add(<span class="hljs-name">Process.pointerSize</span> + Process.pointerSize) is <span class="hljs-string">&quot;const size_t size_;&quot;</span><br>                    var base = ptr(<span class="hljs-name">dex_file</span>).add(<span class="hljs-name">Process.pointerSize</span>).readPointer()<span class="hljs-comment">;</span><br>                    var size = ptr(<span class="hljs-name">dex_file</span>).add(<span class="hljs-name">Process.pointerSize</span> + Process.pointerSize).readUInt()<span class="hljs-comment">;</span><br><br>                    if (<span class="hljs-name">dex_maps</span>[<span class="hljs-name">base</span>] == undefined) &#123;<br>                        dex_maps[<span class="hljs-name">base</span>] = size<span class="hljs-comment">;</span><br>                        var magic = ptr(<span class="hljs-name">base</span>).readCString()<span class="hljs-comment">;</span><br>                        if (<span class="hljs-name">magic.indexOf</span>(<span class="hljs-string">&quot;dex&quot;</span>) == <span class="hljs-number">0</span>) &#123;<br><br>                            var process_name = get_self_process_name()<span class="hljs-comment">;</span><br>                            if (<span class="hljs-name">process_name</span> != <span class="hljs-string">&quot;-1&quot;</span>) &#123;<br>                                var dex_dir_path = <span class="hljs-string">&quot;/data/data/&quot;</span> + process_name + <span class="hljs-string">&quot;/files/dump_dex_&quot;</span> + process_name<span class="hljs-comment">;</span><br>                                mkdir(<span class="hljs-name">dex_dir_path</span>)<span class="hljs-comment">;</span><br>                                var dex_path = dex_dir_path + <span class="hljs-string">&quot;/class&quot;</span> + (<span class="hljs-name">dex_count</span> == <span class="hljs-number">1</span> ? <span class="hljs-string">&quot;&quot;</span> : dex_count) + <span class="hljs-string">&quot;.dex&quot;</span><span class="hljs-comment">;</span><br>                                console.log(<span class="hljs-string">&quot;[find dex]:&quot;</span>, dex_path)<span class="hljs-comment">;</span><br>                                var fd = new File(<span class="hljs-name">dex_path</span>, <span class="hljs-string">&quot;wb&quot;</span>)<span class="hljs-comment">;</span><br>                                if (<span class="hljs-name">fd</span> &amp;&amp; fd != null) &#123;<br>                                    dex_count++<span class="hljs-comment">;</span><br>                                    var dex_buffer = ptr(<span class="hljs-name">base</span>).readByteArray(<span class="hljs-name">size</span>)<span class="hljs-comment">;</span><br>                                    fd.write(<span class="hljs-name">dex_buffer</span>)<span class="hljs-comment">;</span><br>                                    fd.flush()<span class="hljs-comment">;</span><br>                                    fd.close()<span class="hljs-comment">;</span><br>                                    console.log(<span class="hljs-string">&quot;[dump dex]:&quot;</span>, dex_path)<span class="hljs-comment">;</span><br><br>                                &#125;<br>                            &#125;<br>                        &#125;<br>                    &#125;<br>                &#125;,<br>                onLeave: function(<span class="hljs-name">retval</span>) &#123;&#125;<br>            &#125;)<span class="hljs-comment">;</span><br>        &#125;<br>    &#125;<br><br>    function main() &#123;<br>        klogData(<span class="hljs-string">&quot;&quot;</span>, <span class="hljs-string">&quot;init&quot;</span>, <span class="hljs-string">&quot;dump_dex.js init hook success&quot;</span>)<br>        dump_dex()<span class="hljs-comment">;</span><br>    &#125;<br>    setImmediate(<span class="hljs-name">main</span>)<span class="hljs-comment">;</span><br>&#125;)()<span class="hljs-comment">;</span><br><br></code></pre></td></tr></table></figure>

<p>运行  frida -UF -l .\dump_dex.js  ， 为了保证能脱壳，app 的每个板块都点一点。</p>
<figure class="highlight roboconf"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br></pre></td><td class="code"><pre><code class="hljs roboconf">PS C:\Users\TigerHu\NewFlold\7__study\2__Frida\他趣脱壳&gt; frida -UF -l .\dump_dex.js<br>     ____<br>    / _  |   Frida 16.1.0 - A world-class dynamic instrumentation toolkit<br>   | (_| |<br>    &gt; _  |   Commands:<br>   /_/ |_|       help      -&gt; Displays the help system<br>   . . . .       object?   -&gt; Display information about &#x27;object&#x27;<br>   . . . .       exit/quit -&gt; Exit<br>   . . . .<br>   . . . .   More info at https://frida.re/docs/home/<br>   . . . .<br>   . . . .   Connected to Pixel 6 Pro (id=1B231FDEE005T0)<br>_ZN3art11ClassLinker11DefineClassEPNS_6ThreadEPKcmNS_6HandleINS_6mirror11ClassLoaderEEERKNS_7DexFileERKNS_3dex8ClassDefE 0x6d87590ab0<br>[DefineClass:] 0x6d87590ab0<br>message: &#123;&#x27;<span class="hljs-attribute">type&#x27;</span>: &#x27;send&#x27;, &#x27;payload&#x27;: &#123;&#x27;jsname&#x27;: &#x27;dump_dex&#x27;, &#x27;data&#x27;: &#x27;&#x27;, &#x27;init&#x27;: &#x27;dump_dex<span class="hljs-variable">.js</span> init hook success&#x27;&#125;&#125; data: None<br>[Pixel 6 Pro::他趣 ]-&gt; [find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class2<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class2<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class3<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class3<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class4<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class4<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class5<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class5<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class6<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class6<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class7<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class7<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class8<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class8<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class9<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class9<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class10<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class10<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class11<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class11<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class12<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class12<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class13<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class13<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class14<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class14<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class15<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class15<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class16<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class16<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class17<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class17<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class18<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class18<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class19<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class19<span class="hljs-variable">.dex</span><br>[find dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class20<span class="hljs-variable">.dex</span><br>[dump dex]: /data/data/com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/files/dump_dex_com<span class="hljs-variable">.xingjiabi</span><span class="hljs-variable">.shengsheng</span>/class20<span class="hljs-variable">.dex</span><br></code></pre></td></tr></table></figure>

<p>在手机内可以看到脱壳出来的dex 文件，随后直接拖到jadx里，就可以分析了。<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240111224602621.png" srcset="/img/loading.gif" lazyload></p>
<h1 id="分析app内各种检测"><a href="#分析app内各种检测" class="headerlink" title="分析app内各种检测"></a>分析app内各种检测</h1><p>分析app 反调试、运行环境检测技术。</p>
<h2 id="root-检测"><a href="#root-检测" class="headerlink" title="root 检测"></a>root 检测</h2><p>前面我们知道app 会对运行环境进行检测，但是直接搜索 字符串 弹窗的信息，是搜不出来的，这是由于 apk 对字符串做了base64 处理。</p>
<p>然后以前分析过一些对root 环境监测的代码，所以这里直接搜索，定位到代码 cn.taqu.lib.base.utils.AppAntiUtils.isDeviceRooted()<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145319294.png" srcset="/img/loading.gif" lazyload><br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240114160423598.png" srcset="/img/loading.gif" lazyload></p>
<p>然后找到这一块的代码<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145342031.png" srcset="/img/loading.gif" lazyload></p>
<p>base64 解码<br><img src="/70__%E9%80%86%E5%90%91__%E4%BB%96%E8%B6%A3APP.assets/image-20240112145108350.png" srcset="/img/loading.gif" lazyload></p>
<p>另外还看到不仅仅对 su 进行检测，还检测了其他的项，如下函数。这个函数在 cn.taqu.lib.base.utils.AppAntiUtils.initAnti() 初始化的时候调用，</p>
<figure class="highlight coq"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><code class="hljs coq">public static boolean isDeviceRooted(RootBeer rootBeer) &#123;<br>  <br>    HbTrace.d(<span class="hljs-number">38850</span>);<br>    boolean z2 = rootBeer.checkForBinary(x.f13157a) |<span class="hljs-type">| rootBeer</span>.checkForDangerousProps() |<span class="hljs-type">| rootBeer</span>.checkForRWPaths() |<span class="hljs-type">| rootBeer</span>.detectTestKeys() |<span class="hljs-type">| rootBeer</span>.checkSuExists() |<span class="hljs-type">| rootBeer</span>.checkForRootNative() |<span class="hljs-type">| rootBeer</span>.checkForMagiskBinary();<br>    HbTrace.h(<span class="hljs-number">38850</span>);<br>    <span class="hljs-keyword">return</span> z2;<br>&#125;<br></code></pre></td></tr></table></figure>
<p>可以看到调用了 isDeviceRooted，两个重构函数，来判断是否root，最后弹窗</p>
<figure class="highlight lasso"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><code class="hljs lasso"><span class="hljs-literal">cn</span>.taqu.lib.base.utils.AppAntiUtils.initAnti()<br><br><span class="hljs-keyword">if</span> (!AppAntiUtils.access$<span class="hljs-number">900</span>() &amp;&amp; !AppAntiUtils.access$<span class="hljs-number">1000</span>() &amp;&amp; <span class="hljs-string">&quot;1&quot;</span>.<span class="hljs-keyword">equals</span>(AppAntiUtils.access$<span class="hljs-number">200</span>())) &#123;<br>	<span class="hljs-built_in">boolean</span> isDeviceRooted = AppAntiUtils.isDeviceRooted(); <span class="hljs-comment">// 判断su</span><br>	<span class="hljs-built_in">boolean</span> isDeviceRooted2 = AppAntiUtils.isDeviceRooted(RootBeer.this); <span class="hljs-comment">// 判断其他</span><br>	<span class="hljs-keyword">if</span> (isDeviceRooted2 || isDeviceRooted) &#123;<br>		Loger.g(AppAntiUtils.<span class="hljs-built_in">TAG</span>, PushConstants.PUSH_VALUE_ROOT);<br>		XLogUpload.k(<span class="hljs-string">&quot;AntiRoot&quot;</span>).b(<span class="hljs-string">&quot;device rooted.&quot;</span>).m(<span class="hljs-string">&quot;RootBeer&quot;</span>, <span class="hljs-built_in">String</span>.valueOf(isDeviceRooted2)).m(<span class="hljs-string">&quot;DeviceRooted&quot;</span>, <span class="hljs-built_in">String</span>.valueOf(isDeviceRooted)).o();<br>		AppAntiUtils.access$<span class="hljs-number">1100</span>();  <span class="hljs-comment">// 弹窗</span><br>	&#125;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p>这里来分析一下 isDeviceRooted(RootBeer rootBeer) 内对运行环境是如何检测的代码。<br>首先分析一下 rootBeer.checkForBinary(x.f13157a)，这个函数是检测在一些文件路径内是否存在 x.f13157a ( su 文件 )， 有关Const.getPaths() 函数的代码详见附录 1 。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkForBinary</span>(<span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span>) &#123;<br>    <span class="hljs-built_in">String</span>[] paths;<br>    <span class="hljs-type">boolean</span> z2 = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> str2 : Const.<span class="hljs-property">getPaths</span>()) &#123;<br>        <span class="hljs-built_in">String</span> str3 = str2 + <span class="hljs-built_in">str</span>;<br>        <span class="hljs-keyword">if</span> (<span class="hljs-keyword">new </span><span class="hljs-class title_">File</span>(str2, <span class="hljs-built_in">str</span>).<span class="hljs-property">exists</span>()) &#123;<br>            QLog.<span class="hljs-property">v</span>(str3 + <span class="hljs-string">&quot; binary detected!&quot;</span>);<br>            z2 = <span class="hljs-literal">true</span>;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> z2;<br>&#125;<br><br></code></pre></td></tr></table></figure>

<p> rootBeer.checkForDangerousProps() 就是判断系统的调试模式是否被打开。</p>
<figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkForDangerousProps</span>() &#123;<br>    <span class="hljs-built_in">HashMap</span> hashMap = <span class="hljs-keyword">new </span><span class="hljs-class title_">HashMap</span>();<br>    hashMap.<span class="hljs-property">put</span>(<span class="hljs-string">&quot;ro.debuggable&quot;</span>, <span class="hljs-string">&quot;1&quot;</span>);<br>    hashMap.<span class="hljs-property">put</span>(<span class="hljs-string">&quot;ro.secure&quot;</span>, <span class="hljs-string">&quot;0&quot;</span>);<br>    <span class="hljs-built_in">String</span>[] propsReader = <span class="hljs-title function_">propsReader</span>();<br>    <span class="hljs-keyword">if</span> (propsReader == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-type">boolean</span> z2 = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span> : propsReader) &#123;<br>        <span class="hljs-keyword">for</span> (<span class="hljs-built_in">String</span> str2 : hashMap.<span class="hljs-property">keySet</span>()) &#123;<br>            <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span>.<span class="hljs-property">contains</span>(str2)) &#123;<br>                <span class="hljs-built_in">String</span> str3 = <span class="hljs-string">&quot;[&quot;</span> + ((<span class="hljs-built_in">String</span>) hashMap.<span class="hljs-property">get</span>(str2)) + <span class="hljs-string">&quot;]&quot;</span>;<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span>.<span class="hljs-property">contains</span>(str3)) &#123;<br>                    QLog.<span class="hljs-property">v</span>(str2 + <span class="hljs-string">&quot; = &quot;</span> + str3 + <span class="hljs-string">&quot; detected!&quot;</span>);<br>                    z2 = <span class="hljs-literal">true</span>;<br>                &#125;<br>            &#125;<br>        &#125;<br>    &#125;<br>    <span class="hljs-keyword">return</span> z2;<br></code></pre></td></tr></table></figure>

<p>rootBeer.checkForRWPaths() 检查系统中是否存在被挂载为可读写（rw）权限的应用程序数据目录以及其他指定的路径，并返回一个布尔值表示是否存在这样的路径。该函数会读取系统中关于挂载点的信息，检查每一个挂载点的路径和权限信息，如果发现某个路径被挂载为可读写权限，则会输出相应的日志信息并将返回值设为 true。该函数可以用于检测系统安全性，防止应用程序滥用高权限目录，代码太长，详见 附录 2 。</p>
<p>rootBeer.detectTestKeys() 该函数会读取设备的 Build.TAGS 字段是否有 “ test-keys ”，检测当前设备是否使用测试用的密钥签名。</p>
<p>root.Beer. checkSuExists() 函数会调用 which 命令，查找是否存在 su 命令。</p>
<p>rootBeer.checkForRootNative() 函数会加载本地 toolChecker 的 lib 库文件来检测是否被获取root 权限，调用 native 内的 checkForRoot() 函数，来判断设备是否获得root权限，其实还是检测是否存在 su 文件。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-class"><span class="hljs-keyword">class</span> <span class="hljs-title">RootBeerNative</span> </span>&#123;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">boolean</span> libraryLoaded = <span class="hljs-keyword">false</span>;<br><br>    <span class="hljs-keyword">static</span> &#123;<br>        <span class="hljs-keyword">try</span> &#123;<br>            System.loadLibrary(<span class="hljs-string">&quot;toolChecker&quot;</span>);<br>            libraryLoaded = <span class="hljs-keyword">true</span>;<br>        &#125; <span class="hljs-keyword">catch</span> (UnsatisfiedLinkError e) &#123;<br>            QLog.e(e);<br>        &#125;<br>    &#125;<br><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">checkForRoot</span><span class="hljs-params">(Object[] objArr)</span></span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">native</span> <span class="hljs-function"><span class="hljs-keyword">int</span> <span class="hljs-title">setLogDebugMessages</span><span class="hljs-params">(<span class="hljs-keyword">boolean</span> z2)</span></span>;<br>    <span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">wasNativeLibraryLoaded</span><span class="hljs-params">()</span> </span>&#123;<br>        <span class="hljs-keyword">return</span> libraryLoaded;<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>rootBeer.checkForMagiskBinary() 检测是否存在Magisk 面具，如果进程名被更改就检测不到了。</p>
<figure class="highlight aspectj"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><code class="hljs aspectj"><span class="hljs-keyword">public</span> <span class="hljs-function"><span class="hljs-keyword">boolean</span> <span class="hljs-title">checkForMagiskBinary</span><span class="hljs-params">()</span> </span>&#123;<br>    <span class="hljs-function"><span class="hljs-keyword">return</span> <span class="hljs-title">checkForBinary</span><span class="hljs-params">(<span class="hljs-string">&quot;magisk&quot;</span>)</span></span>;<br>&#125;<br></code></pre></td></tr></table></figure>

<p>其实还有一些检测的代码，这个app 对root 检测已经是相当的全面了。</p>
<h2 id="完整性签名校验"><a href="#完整性签名校验" class="headerlink" title="完整性签名校验"></a>完整性签名校验</h2><p>计算签名摘要，进行对比。</p>
<figure class="highlight awk"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><code class="hljs awk">&#125; <span class="hljs-keyword">else</span> <span class="hljs-keyword">if</span> (!sHbSignature.equals(getSHA1Signature(BaseApplication.getInstance()))) &#123;<br>    XLogUpload.k(<span class="hljs-string">&quot;AntiSign&quot;</span>).b(<span class="hljs-string">&quot;签名文件不一致&quot;</span>).o();<br>    ToastUtils.b(BaseApplication.getInstance(), new String(Base64.decode(<span class="hljs-string">&quot;5qOA5rWL5Yiw5oKo5a6J6KOF5YiwQVBQ5a2Y5Zyo6Zeu6aKY77yM5Li65LqG5L+d6K+B5q2j5bi45L2/55So6K+35LiL6L295a6Y5pa554mI5pys&quot;</span>, <span class="hljs-number">0</span>)));<br>    System.<span class="hljs-keyword">exit</span>(<span class="hljs-number">0</span>);<br>    HbTrace.h(<span class="hljs-number">38784</span>);<br><br><br><br><br></code></pre></td></tr></table></figure>

<h2 id="代理检测"><a href="#代理检测" class="headerlink" title="代理检测"></a>代理检测</h2><figure class="highlight pgsql"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><code class="hljs pgsql">cn.taqu.lib.base.utils.AppAntiUtils line21~line22<br><br>	<span class="hljs-keyword">if</span> (!AppAntiUtils.<span class="hljs-keyword">access</span><span class="hljs-meta">$600</span>() &amp;&amp; !AppAntiUtils.<span class="hljs-keyword">access</span><span class="hljs-meta">$700</span>() &amp;&amp; !ApplicationHelper.u() &amp;&amp; OkHttpDns.a(BaseApplication.getInstance())) &#123;<br>		AppAntiUtils.<span class="hljs-keyword">access</span><span class="hljs-meta">$800</span>();<br>	&#125;<br><br>hb.common.helper.OKHttpDns line1~line2<br>    <span class="hljs-built_in">public</span> static <span class="hljs-type">boolean</span> a(Context ctx) &#123;<br>        HbTrace.d(<span class="hljs-number">44874</span>);<br>        String property = <span class="hljs-keyword">System</span>.getProperty(&quot;http.proxyHost&quot;);<br>        String property2 = <span class="hljs-keyword">System</span>.getProperty(&quot;http.proxyPort&quot;);<br>        <span class="hljs-keyword">if</span> (property2 == <span class="hljs-keyword">null</span>) &#123;<br>            property2 = &quot;-1&quot;;<br>        &#125;<br>        <span class="hljs-type">boolean</span> z2 = (property == <span class="hljs-keyword">null</span> || <span class="hljs-type">Integer</span>.parseInt(property2) == <span class="hljs-number">-1</span>) ? <span class="hljs-keyword">false</span> : <span class="hljs-keyword">true</span>;<br>        HbTrace.h(<span class="hljs-number">44874</span>);<br>        <span class="hljs-keyword">return</span> z2;<br>    &#125;<br></code></pre></td></tr></table></figure>




<h1 id="参考"><a href="#参考" class="headerlink" title="参考"></a>参考</h1><p>APP 使用frida 反调试检测绕过<br><a target="_blank" rel="noopener" href="https://www.cnblogs.com/dxmao/articles/17678351.html">https://www.cnblogs.com/dxmao/articles/17678351.html</a></p>
<p>视频讲解<br><a target="_blank" rel="noopener" href="https://www.bilibili.com/video/BV1e94y1V7wZ/?spm_id_from=333.999.0.0&vd_source=cd4aba572b443cbbb4c522c3c649652d">https://www.bilibili.com/video/BV1e94y1V7wZ/?spm_id_from=333.999.0.0&amp;vd_source=cd4aba572b443cbbb4c522c3c649652d</a></p>
<h1 id="附录"><a href="#附录" class="headerlink" title="附录"></a>附录</h1><h2 id="附录-1"><a href="#附录-1" class="headerlink" title="附录 1"></a>附录 1</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><code class="hljs processing"><span class="hljs-keyword">package</span> com.<span class="hljs-property">scottyab</span>.<span class="hljs-property">rootbeer</span>;<br><br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">ArrayList</span>;<br><span class="hljs-keyword">import</span> java.<span class="hljs-property">util</span>.<span class="hljs-property">Arrays</span>;<br><span class="hljs-keyword">import</span> me.<span class="hljs-property">panpf</span>.<span class="hljs-property">sketch</span>.<span class="hljs-property">uri</span>.<span class="hljs-property">FileUriModel</span>;<br><br><span class="hljs-comment">/* loaded from: E:\file\android逆向\蓝狐视频\他趣app\class13.dex */</span><br><span class="hljs-keyword">final</span> <span class="hljs-keyword">class</span> <span class="hljs-title class_">Const</span> &#123;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> BINARY_BUSYBOX = <span class="hljs-string">&quot;busybox&quot;</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span> BINARY_SU = <span class="hljs-string">&quot;su&quot;</span>;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>[] knownRootAppsPackages = &#123;<span class="hljs-string">&quot;com.noshufou.android.su&quot;</span>, <span class="hljs-string">&quot;com.noshufou.android.su.elite&quot;</span>, <span class="hljs-string">&quot;eu.chainfire.supersu&quot;</span>, <span class="hljs-string">&quot;com.koushikdutta.superuser&quot;</span>, <span class="hljs-string">&quot;com.thirdparty.superuser&quot;</span>, <span class="hljs-string">&quot;com.yellowes.su&quot;</span>, <span class="hljs-string">&quot;com.topjohnwu.magisk&quot;</span>, <span class="hljs-string">&quot;com.kingroot.kinguser&quot;</span>, <span class="hljs-string">&quot;com.kingo.root&quot;</span>, <span class="hljs-string">&quot;com.smedialink.oneclickroot&quot;</span>, <span class="hljs-string">&quot;com.zhiqupk.root.global&quot;</span>, <span class="hljs-string">&quot;com.alephzain.framaroot&quot;</span>&#125;;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>[] knownDangerousAppsPackages = &#123;<span class="hljs-string">&quot;com.koushikdutta.rommanager&quot;</span>, <span class="hljs-string">&quot;com.koushikdutta.rommanager.license&quot;</span>, <span class="hljs-string">&quot;com.dimonvideo.luckypatcher&quot;</span>, <span class="hljs-string">&quot;com.chelpus.lackypatch&quot;</span>, <span class="hljs-string">&quot;com.ramdroid.appquarantine&quot;</span>, <span class="hljs-string">&quot;com.ramdroid.appquarantinepro&quot;</span>, <span class="hljs-string">&quot;com.android.vending.billing.InAppBillingService.COIN&quot;</span>, <span class="hljs-string">&quot;com.android.vending.billing.InAppBillingService.LUCK&quot;</span>, <span class="hljs-string">&quot;com.chelpus.luckypatcher&quot;</span>, <span class="hljs-string">&quot;com.blackmartalpha&quot;</span>, <span class="hljs-string">&quot;org.blackmart.market&quot;</span>, <span class="hljs-string">&quot;com.allinone.free&quot;</span>, <span class="hljs-string">&quot;com.repodroid.app&quot;</span>, <span class="hljs-string">&quot;org.creeplays.hack&quot;</span>, <span class="hljs-string">&quot;com.baseappfull.fwd&quot;</span>, <span class="hljs-string">&quot;com.zmapp&quot;</span>, <span class="hljs-string">&quot;com.dv.marketmod.installer&quot;</span>, <span class="hljs-string">&quot;org.mobilism.android&quot;</span>, <span class="hljs-string">&quot;com.android.wp.net.log&quot;</span>, <span class="hljs-string">&quot;com.android.camera.update&quot;</span>, <span class="hljs-string">&quot;cc.madkite.freedom&quot;</span>, <span class="hljs-string">&quot;com.solohsu.android.edxp.manager&quot;</span>, <span class="hljs-string">&quot;org.meowcat.edxposed.manager&quot;</span>, <span class="hljs-string">&quot;com.xmodgame&quot;</span>, <span class="hljs-string">&quot;com.cih.game_cih&quot;</span>, <span class="hljs-string">&quot;com.charles.lpoqasert&quot;</span>, <span class="hljs-string">&quot;catch_.me_.if_.you_.can_&quot;</span>&#125;;<br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>[] knownRootCloakingPackages = &#123;<span class="hljs-string">&quot;com.devadvance.rootcloak&quot;</span>, <span class="hljs-string">&quot;com.devadvance.rootcloakplus&quot;</span>, <span class="hljs-string">&quot;de.robv.android.xposed.installer&quot;</span>, <span class="hljs-string">&quot;com.saurik.substrate&quot;</span>, <span class="hljs-string">&quot;com.zachspong.temprootremovejb&quot;</span>, <span class="hljs-string">&quot;com.amphoras.hidemyroot&quot;</span>, <span class="hljs-string">&quot;com.amphoras.hidemyrootadfree&quot;</span>, <span class="hljs-string">&quot;com.formyhm.hiderootPremium&quot;</span>, <span class="hljs-string">&quot;com.formyhm.hideroot&quot;</span>&#125;;<br>    <span class="hljs-keyword">private</span> <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>[] suPaths = &#123;<span class="hljs-string">&quot;/data/local/&quot;</span>, <span class="hljs-string">&quot;/data/local/bin/&quot;</span>, <span class="hljs-string">&quot;/data/local/xbin/&quot;</span>, <span class="hljs-string">&quot;/sbin/&quot;</span>, <span class="hljs-string">&quot;/su/bin/&quot;</span>, <span class="hljs-string">&quot;/system/bin/&quot;</span>, <span class="hljs-string">&quot;/system/bin/.ext/&quot;</span>, <span class="hljs-string">&quot;/system/bin/failsafe/&quot;</span>, <span class="hljs-string">&quot;/system/sd/xbin/&quot;</span>, <span class="hljs-string">&quot;/system/usr/we-need-root/&quot;</span>, <span class="hljs-string">&quot;/system/xbin/&quot;</span>, <span class="hljs-string">&quot;/cache/&quot;</span>, <span class="hljs-string">&quot;/data/&quot;</span>, <span class="hljs-string">&quot;/dev/&quot;</span>&#125;;<br>    <span class="hljs-keyword">static</span> <span class="hljs-keyword">final</span> <span class="hljs-built_in">String</span>[] pathsThatShouldNotBeWritable = &#123;<span class="hljs-string">&quot;/system&quot;</span>, <span class="hljs-string">&quot;/system/bin&quot;</span>, <span class="hljs-string">&quot;/system/sbin&quot;</span>, <span class="hljs-string">&quot;/system/xbin&quot;</span>, <span class="hljs-string">&quot;/vendor/bin&quot;</span>, <span class="hljs-string">&quot;/sbin&quot;</span>, <span class="hljs-string">&quot;/etc&quot;</span>&#125;;<br><br>    <span class="hljs-keyword">private</span> <span class="hljs-title function_">Const</span>() <span class="hljs-keyword">throws</span> InstantiationException &#123;<br>        <span class="hljs-keyword">throw</span> <span class="hljs-keyword">new </span><span class="hljs-class title_">InstantiationException</span>(<span class="hljs-string">&quot;This class is not for instantiation&quot;</span>);<br>    &#125;<br><br>    <span class="hljs-comment">/* JADX INFO: Access modifiers changed from: package-private */</span><br>    <span class="hljs-keyword">public</span> <span class="hljs-keyword">static</span> <span class="hljs-built_in">String</span>[] <span class="hljs-title function_">getPaths</span>() &#123;<br>        <span class="hljs-built_in">ArrayList</span> arrayList = <span class="hljs-keyword">new </span><span class="hljs-class title_">ArrayList</span>(Arrays.<span class="hljs-property">asList</span>(suPaths));<br>        <span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span> = System.<span class="hljs-property">getenv</span>(<span class="hljs-string">&quot;PATH&quot;</span>);<br>        <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span> != <span class="hljs-literal">null</span> &amp;&amp; !<span class="hljs-string">&quot;&quot;</span>.<span class="hljs-property">equals</span>(<span class="hljs-built_in">str</span>)) &#123;<br>            <span class="hljs-built_in">String</span>[] <span class="hljs-built_in">split</span> = <span class="hljs-built_in">str</span>.<span class="hljs-property">split</span>(<span class="hljs-string">&quot;:&quot;</span>);<br>            <span class="hljs-type">int</span> length = <span class="hljs-built_in">split</span>.<span class="hljs-property">length</span>;<br>            <span class="hljs-keyword">for</span> (<span class="hljs-type">int</span> i2 = <span class="hljs-number">0</span>; i2 &lt; length; i2++) &#123;<br>                <span class="hljs-built_in">String</span> str2 = <span class="hljs-built_in">split</span>[i2];<br>                <span class="hljs-keyword">if</span> (!str2.<span class="hljs-property">endsWith</span>(FileUriModel.<span class="hljs-property">SCHEME</span>)) &#123;<br>                    str2 = str2 + <span class="hljs-string">&#x27;/&#x27;</span>;<br>                &#125;<br>                <span class="hljs-keyword">if</span> (!arrayList.<span class="hljs-property">contains</span>(str2)) &#123;<br>                    arrayList.<span class="hljs-property">add</span>(str2);<br>                &#125;<br>            &#125;<br>            <span class="hljs-title function_">return</span> (<span class="hljs-built_in">String</span>[]) arrayList.<span class="hljs-property">toArray</span>(<span class="hljs-keyword">new </span><span class="hljs-class title_">String</span>[<span class="hljs-number">0</span>]);<br>        &#125;<br>        <span class="hljs-title function_">return</span> (<span class="hljs-built_in">String</span>[]) arrayList.<span class="hljs-property">toArray</span>(<span class="hljs-keyword">new </span><span class="hljs-class title_">String</span>[<span class="hljs-number">0</span>]);<br>    &#125;<br>&#125;<br></code></pre></td></tr></table></figure>

<h2 id="附录2"><a href="#附录2" class="headerlink" title="附录2"></a>附录2</h2><figure class="highlight processing"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br><span class="line">59</span><br><span class="line">60</span><br><span class="line">61</span><br><span class="line">62</span><br><span class="line">63</span><br><span class="line">64</span><br><span class="line">65</span><br></pre></td><td class="code"><pre><code class="hljs processing"><br><span class="hljs-keyword">public</span> <span class="hljs-type">boolean</span> <span class="hljs-title function_">checkForRWPaths</span>() &#123;<br>    <span class="hljs-built_in">String</span> <span class="hljs-built_in">str</span>;<br>    <span class="hljs-built_in">String</span> str2;<br>    <span class="hljs-built_in">String</span>[] strArr;<br>    <span class="hljs-built_in">String</span>[] mountReader = <span class="hljs-title function_">mountReader</span>();<br>    <span class="hljs-keyword">if</span> (mountReader == <span class="hljs-literal">null</span>) &#123;<br>        <span class="hljs-keyword">return</span> <span class="hljs-literal">false</span>;<br>    &#125;<br>    <span class="hljs-type">int</span> i2 = Build.<span class="hljs-property">VERSION</span>.<span class="hljs-property">SDK_INT</span>;<br>    <span class="hljs-type">int</span> length = mountReader.<span class="hljs-property">length</span>;<br>    <span class="hljs-type">int</span> i3 = <span class="hljs-number">0</span>;<br>    <span class="hljs-type">boolean</span> z2 = <span class="hljs-literal">false</span>;<br>    <span class="hljs-keyword">while</span> (i3 &lt; length) &#123;<br>        <span class="hljs-built_in">String</span> str3 = mountReader[i3];<br>        <span class="hljs-built_in">String</span>[] <span class="hljs-built_in">split</span> = str3.<span class="hljs-property">split</span>(<span class="hljs-string">&quot; &quot;</span>);<br>        <span class="hljs-type">int</span> i4 = <span class="hljs-number">23</span>;<br>        <span class="hljs-keyword">if</span> ((i2 &lt;= <span class="hljs-number">23</span> &amp;&amp; <span class="hljs-built_in">split</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">4</span>) || (i2 &gt; <span class="hljs-number">23</span> &amp;&amp; <span class="hljs-built_in">split</span>.<span class="hljs-property">length</span> &lt; <span class="hljs-number">6</span>)) &#123;<br>            QLog.<span class="hljs-property">e</span>(<span class="hljs-string">&quot;Error formatting mount line: &quot;</span> + str3);<br>        &#125; <span class="hljs-keyword">else</span> &#123;<br>            <span class="hljs-keyword">if</span> (i2 &gt; <span class="hljs-number">23</span>) &#123;<br>                <span class="hljs-built_in">str</span> = <span class="hljs-built_in">split</span>[<span class="hljs-number">2</span>];<br>                str2 = <span class="hljs-built_in">split</span>[<span class="hljs-number">5</span>];<br>            &#125; <span class="hljs-keyword">else</span> &#123;<br>                <span class="hljs-built_in">str</span> = <span class="hljs-built_in">split</span>[<span class="hljs-number">1</span>];<br>                str2 = <span class="hljs-built_in">split</span>[<span class="hljs-number">3</span>];<br>            &#125;<br>            <span class="hljs-built_in">String</span>[] strArr2 = Const.<span class="hljs-property">pathsThatShouldNotBeWritable</span>;<br>            <span class="hljs-type">int</span> length2 = strArr2.<span class="hljs-property">length</span>;<br>            <span class="hljs-type">int</span> i5 = <span class="hljs-number">0</span>;<br>            <span class="hljs-keyword">while</span> (i5 &lt; length2) &#123;<br>                <span class="hljs-built_in">String</span> str4 = strArr2[i5];<br>                <span class="hljs-keyword">if</span> (<span class="hljs-built_in">str</span>.<span class="hljs-property">equalsIgnoreCase</span>(str4)) &#123;<br>                    <span class="hljs-keyword">if</span> (Build.<span class="hljs-property">VERSION</span>.<span class="hljs-property">SDK_INT</span> &gt; i4) &#123;<br>                        str2 = str2.<span class="hljs-property">replace</span>(<span class="hljs-string">&quot;(&quot;</span>, <span class="hljs-string">&quot;&quot;</span>).<span class="hljs-property">replace</span>(<span class="hljs-string">&quot;)&quot;</span>, <span class="hljs-string">&quot;&quot;</span>);<br>                    &#125;<br>                    <span class="hljs-built_in">String</span>[] split2 = str2.<span class="hljs-property">split</span>(<span class="hljs-string">&quot;,&quot;</span>);<br>                    <span class="hljs-type">int</span> length3 = split2.<span class="hljs-property">length</span>;<br>                    <span class="hljs-type">int</span> i6 = <span class="hljs-number">0</span>;<br>                    <span class="hljs-keyword">while</span> (i6 &lt; length3) &#123;<br>                        strArr = mountReader;<br>                        <span class="hljs-keyword">if</span> (split2[i6].<span class="hljs-property">equalsIgnoreCase</span>(<span class="hljs-string">&quot;rw&quot;</span>)) &#123;<br>                            QLog.<span class="hljs-property">v</span>(str4 + <span class="hljs-string">&quot; path is mounted with rw permissions! &quot;</span> + str3);<br>                            z2 = <span class="hljs-literal">true</span>;<br>                            <span class="hljs-keyword">break</span>;<br>                        &#125;<br>                        i6++;<br>                        mountReader = strArr;<br>                    &#125;<br>                &#125;<br>                strArr = mountReader;<br>                i5++;<br>                mountReader = strArr;<br>                i4 = <span class="hljs-number">23</span>;<br>            &#125;<br>        &#125;<br>        i3++;<br>        mountReader = mountReader;<br>    &#125;<br>    <span class="hljs-keyword">return</span> z2;<br>&#125;<br><br><br><br><br></code></pre></td></tr></table></figure>
                
              </div>
            
            <hr/>
            <div>
              <div class="post-metas my-3">
  
  
</div>


              
  

  <div class="license-box my-3">
    <div class="license-title">
      <div>apk逆向__他趣APP脱壳&amp;运行环境检测分析</div>
      <div>https://tig3rhu.github.io/2024/01/14/70__逆向__他趣APP/</div>
    </div>
    <div class="license-meta">
      
        <div class="license-meta-item">
          <div>Author</div>
          <div>Tig3rHu</div>
        </div>
      
      
        <div class="license-meta-item license-meta-date">
          <div>Posted on</div>
          <div>January 14, 2024</div>
        </div>
      
      
      
        <div class="license-meta-item">
          <div>Licensed under</div>
          <div>
            
              
              
                <a class="print-no-link" target="_blank" href="https://creativecommons.org/licenses/by/4.0/">
                  <span class="hint--top hint--rounded" aria-label="BY - Attribution">
                    <i class="iconfont icon-by"></i>
                  </span>
                </a>
              
            
          </div>
        </div>
      
    </div>
    <div class="license-icon iconfont"></div>
  </div>



              
                <div class="post-prevnext my-3">
                  <article class="post-prev col-6">
                    
                    
                      <a href="/2024/01/14/110_jadx_%E5%86%85%E5%AD%98%E4%B8%8D%E5%A4%9F_%E4%BD%BF%E7%94%A8%E9%97%AA%E9%80%80/" title="环境搭建_jadx_内存不足&amp;使用闪退">
                        <i class="iconfont icon-arrowleft"></i>
                        <span class="hidden-mobile">环境搭建_jadx_内存不足&amp;使用闪退</span>
                        <span class="visible-mobile">Previous</span>
                      </a>
                    
                  </article>
                  <article class="post-next col-6">
                    
                    
                      <a href="/2024/01/07/68__%E9%80%86%E5%90%91__%E6%87%92%E4%BA%BA%E5%90%AC%E4%B9%A6%E5%8E%BB%E4%BC%9A%E5%91%98/" title="apk逆向__懒人听书逆向">
                        <span class="hidden-mobile">apk逆向__懒人听书逆向</span>
                        <span class="visible-mobile">Next</span>
                        <i class="iconfont icon-arrowright"></i>
                      </a>
                    
                  </article>
                </div>
              
            </div>

            
          </article>
        </div>
      </div>
    </div>

    <div class="side-col d-none d-lg-block col-lg-2">
      
  <aside class="sidebar" style="margin-left: -1rem">
    <div id="toc">
  <p class="toc-header">
    <i class="iconfont icon-list"></i>
    <span>Table of Contents</span>
  </p>
  <div class="toc-body" id="toc-body"></div>
</div>



  </aside>


    </div>
  </div>
</div>





  



  



  



  



  







    

    
      <a id="scroll-top-button" aria-label="TOP" href="#" role="button">
        <i class="iconfont icon-arrowup" aria-hidden="true"></i>
      </a>
    

    
      <div class="modal fade" id="modalSearch" tabindex="-1" role="dialog" aria-labelledby="ModalLabel"
     aria-hidden="true">
  <div class="modal-dialog modal-dialog-scrollable modal-lg" role="document">
    <div class="modal-content">
      <div class="modal-header text-center">
        <h4 class="modal-title w-100 font-weight-bold">Search</h4>
        <button type="button" id="local-search-close" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body mx-3">
        <div class="md-form mb-5">
          <input type="text" id="local-search-input" class="form-control validate">
          <label data-error="x" data-success="v" for="local-search-input">Keyword</label>
        </div>
        <div class="list-group" id="local-search-result"></div>
      </div>
    </div>
  </div>
</div>

    

    
  </main>

  <footer>
    <div class="footer-inner">
  
    <div class="footer-content">
       <a href="https://hexo.io" target="_blank" rel="nofollow noopener"><span>Hexo</span></a> <i class="iconfont icon-love"></i> <a href="https://github.com/fluid-dev/hexo-theme-fluid" target="_blank" rel="nofollow noopener"><span>Fluid</span></a> 
    </div>
  
  
  
  
</div>

  </footer>

  <!-- Scripts -->
  
  <script  src="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.js" ></script>
  <link  rel="stylesheet" href="https://lib.baomitu.com/nprogress/0.2.0/nprogress.min.css" />

  <script>
    NProgress.configure({"showSpinner":false,"trickleSpeed":100})
    NProgress.start()
    window.addEventListener('load', function() {
      NProgress.done();
    })
  </script>


<script  src="https://lib.baomitu.com/jquery/3.6.4/jquery.min.js" ></script>
<script  src="https://lib.baomitu.com/twitter-bootstrap/4.6.1/js/bootstrap.min.js" ></script>
<script  src="/js/events.js" ></script>
<script  src="/js/plugins.js" ></script>


  <script  src="https://lib.baomitu.com/typed.js/2.0.12/typed.min.js" ></script>
  <script>
    (function (window, document) {
      var typing = Fluid.plugins.typing;
      var subtitle = document.getElementById('subtitle');
      if (!subtitle || !typing) {
        return;
      }
      var text = subtitle.getAttribute('data-typed-text');
      
        typing(text);
      
    })(window, document);
  </script>




  
    <script  src="/js/img-lazyload.js" ></script>
  




  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/tocbot/4.20.1/tocbot.min.js', function() {
    var toc = jQuery('#toc');
    if (toc.length === 0 || !window.tocbot) { return; }
    var boardCtn = jQuery('#board-ctn');
    var boardTop = boardCtn.offset().top;

    window.tocbot.init(Object.assign({
      tocSelector     : '#toc-body',
      contentSelector : '.markdown-body',
      linkClass       : 'tocbot-link',
      activeLinkClass : 'tocbot-active-link',
      listClass       : 'tocbot-list',
      isCollapsedClass: 'tocbot-is-collapsed',
      collapsibleClass: 'tocbot-is-collapsible',
      scrollSmooth    : true,
      includeTitleTags: true,
      headingsOffset  : -boardTop,
    }, CONFIG.toc));
    if (toc.find('.toc-list-item').length > 0) {
      toc.css('visibility', 'visible');
    }

    Fluid.events.registerRefreshCallback(function() {
      if ('tocbot' in window) {
        tocbot.refresh();
        var toc = jQuery('#toc');
        if (toc.length === 0 || !tocbot) {
          return;
        }
        if (toc.find('.toc-list-item').length > 0) {
          toc.css('visibility', 'visible');
        }
      }
    });
  });
</script>


  <script src=https://lib.baomitu.com/clipboard.js/2.0.11/clipboard.min.js></script>

  <script>Fluid.plugins.codeWidget();</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/anchor-js/4.3.1/anchor.min.js', function() {
    window.anchors.options = {
      placement: CONFIG.anchorjs.placement,
      visible  : CONFIG.anchorjs.visible
    };
    if (CONFIG.anchorjs.icon) {
      window.anchors.options.icon = CONFIG.anchorjs.icon;
    }
    var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
    var res = [];
    for (var item of el) {
      res.push('.markdown-body > ' + item.trim());
    }
    if (CONFIG.anchorjs.placement === 'left') {
      window.anchors.options.class = 'anchorjs-link-left';
    }
    window.anchors.add(res.join(', '));

    Fluid.events.registerRefreshCallback(function() {
      if ('anchors' in window) {
        anchors.removeAll();
        var el = (CONFIG.anchorjs.element || 'h1,h2,h3,h4,h5,h6').split(',');
        var res = [];
        for (var item of el) {
          res.push('.markdown-body > ' + item.trim());
        }
        if (CONFIG.anchorjs.placement === 'left') {
          anchors.options.class = 'anchorjs-link-left';
        }
        anchors.add(res.join(', '));
      }
    });
  });
</script>


  
<script>
  Fluid.utils.createScript('https://lib.baomitu.com/fancybox/3.5.7/jquery.fancybox.min.js', function() {
    Fluid.plugins.fancyBox();
  });
</script>


  <script>Fluid.plugins.imageCaption();</script>

  <script  src="/js/local-search.js" ></script>





<!-- 主题的启动项，将它保持在最底部 -->
<!-- the boot of the theme, keep it at the bottom -->
<script  src="/js/boot.js" ></script>


  

  <noscript>
    <div class="noscript-warning">Blog works best with JavaScript enabled</div>
  </noscript>
</body>
</html>
